name: Create GitHub Release

permissions:
  contents: write
  issues: write
  pull-requests: write

on:
  workflow_call:
    inputs:
      description:
        description: 'Release description'
        required: false
        default: 'This is the release notes for latest version. You can add more details here.'
        type: string
      android_artifact_name:
        required: false
        type: string
        default: "appbundle"
      ios_artifact_name:
        required: false
        type: string
        default: "ipa"
      working_directory:
        required: false
        type: string
        default: "."
    secrets:
      gh_token:
        required: true


jobs:
  release:
    name: Deveji - GitHub Release
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“š Git Checkout
        uses: actions/checkout@v4.1.6
              
      - name: ğŸ·ï¸ Flutter Auto Tag
        id: tag_version
        uses: jacopocarlini/action-autotag@3.0.0
        with:
          GITHUB_TOKEN: "${{ secrets.gh_token }}"
          tag_prefix: "v"
          tag_message: "${{ inputs.description }}"
          package_root: "${{ inputs.working_directory }}"

      - name: ğŸ—‚ï¸ Create Build Output Directory
        run: mkdir -p outputs

      - name: ğŸ“¦ Get All Builds from cache
        continue-on-error: true
        uses: actions/cache/restore@v4.0.2
        with:
          path: outputs/**
          key: outputs

      - name: Release
        uses: softprops/action-gh-release@v2.0.5
        with:
          tag_name: ${{ steps.tag_version.outputs.tagname }}
          token: ${{ secrets.gh_token }}
          body: ${{ inputs.description }}
          files: |
            ./outputs/**

          


            